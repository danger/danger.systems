<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta charset="utf-8">
<!-- Always force latest IE rendering engine or request Chrome Frame --><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta content="True" name="HandheldFriendly">
<meta content="480" name="MobileOptimized">
<meta content="width=480, initial-scale=0.6" name="viewport">
<meta content="constant integration culture code" name="keywords">
<meta content="Orta Therox &amp; Felix Krause" name="author">
<meta content="summary" name="twitter:card">
<meta content="@orta" name="twitter:creator">
<meta content="Danger - Reference" name="twitter:title">
<meta content="Apply cultural rules during your CI process." name="twitter:description">
<meta content="http://danger.systems/reference.html" name="twitter:url">
<meta content="/images/square-ffd55d21.png" property="og:image">
<meta content="http://danger.systems/reference.html" property="og:url">
<title>Danger - Reference</title>
<link href="/stylesheets/style-270b5c3f.css" rel="stylesheet">
<link href="/stylesheets/highlight-53578f94.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
</head>
<body class="reference">
<header class="title small"><p>Danger</p>
<a href="/"><img src="/images/title-88a50ec1.png" class="retina" alt="Danger title image"></a><nav><ul>
<li><a href="/">home</a></li>
<li><a href="/guides.html">Guides</a></li>
<li class="big"><a class="highlighted" href="/reference.html">Reference</a></li>
<li class="big"><a href="https://twitter.com/DangerSystems/" target="_blank">Twitter</a></li>
<li class="small"><a class="highlighted" href="/reference.html">Ref</a></li>
</ul></nav></header><h2 class="reduced_top_margin">
<span>Reference</span><code class="byline inline">a project from <a target="_blank" href="http://orta.io">orta therox</a> and <a target="_blank" href="https://github.com/danger/danger/graphs/contributors">other core contributors</a>.</code>
</h2>

<h2><span>bitbucket_server</span></h2>
<section>

<article class="scope_code"><p>Handles interacting with Bitbucket Server inside a Dangerfile. Provides a few functions which wrap <code>pr_json</code> and also
through a few standard functions to simplify your code.</p>
<h3>Reference</h3>
<h4>Methods</h4>
<div class="fake_code">
<p>The hash that represents the PR's JSON. For an example of what this looks like
see the <a href="https://raw.githubusercontent.com/danger/danger/master/spec/fixtures/bitbucket_server_api/pr_response.json" target="_blank">Danger Fixture'd one</a>.</p>
</div>
<code>pr_json <span class="subtle return">Hash</span></code><div class="fake_code">
<p>The title of the Pull Request.</p>
</div>
<code>pr_title <span class="subtle return">String</span></code><div class="fake_code">
<p>The body text of the Pull Request.</p>
</div>
<code>pr_description <span class="subtle return">String</span></code><div class="fake_code">
<p>The body text of the Pull Request.</p>
</div>
<code>pr_body <span class="subtle return">String</span></code><div class="fake_code">
<p>The username of the author of the Pull Request.</p>
</div>
<code>pr_author <span class="subtle return">String</span></code><div class="fake_code">
<p>The branch to which the PR is going to be merged into.</p>
</div>
<code>branch_for_base <span class="subtle return">String</span></code><div class="fake_code">
<p>A href that represents the current PR</p>
</div>
<code>pr_link <span class="subtle return">String</span></code><div class="fake_code">
<p>The branch to which the PR is going to be merged from.</p>
</div>
<code>branch_for_head <span class="subtle return">String</span></code><div class="fake_code">
<p>The base commit to which the PR is going to be merged as a parent.</p>
</div>
<code>base_commit <span class="subtle return">String</span></code><div class="fake_code">
<p>The head commit to which the PR is requesting to be merged from.</p>
</div>
<code>head_commit <span class="subtle return">String</span></code><div class="fake_code">
<p>Returns a list of HTML anchors for a file, or files in the head repository.
It returns a string of multiple anchors if passed an array.</p>
</div>
<code>html_link (paths: String or Array<string>, full_path=true: Bool)<span class="subtle return">String</span></string></code><div class="fake_code">
<p>Returns a list of Markdown links for a file, or files in the head repository.
It returns a string of multiple links if passed an array.</p>
</div>
<code>markdown_link (paths: String or Array<string>, full_path=true: Bool)<span class="subtle return">String</span></string></code></article><article class="scope_code"><h3>Examples</h3>
<h4>Warn when a PR is classed as work in progress</h4>
<div class="highlight"><pre><span class="nb">warn</span> <span class="s2">"PR is classed as Work in Progress"</span> <span class="k">if</span> <span class="n">bitbucket_server</span><span class="o">.</span><span class="n">pr_title</span><span class="o">.</span><span class="n">include?</span> <span class="s2">"[WIP]"</span>
</pre></div>
<h4>Declare a PR to be simple to avoid specific Danger rules</h4>
<div class="highlight"><pre><span class="n">declared_trivial</span> <span class="o">=</span> <span class="p">(</span><span class="n">bitbucket_server</span><span class="o">.</span><span class="n">pr_title</span> <span class="o">+</span> <span class="n">bitbucket_server</span><span class="o">.</span><span class="n">pr_body</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">"#trivial"</span><span class="p">)</span>
</pre></div>
<h4>Ensure that labels have been used on the PR</h4>
<div class="highlight"><pre><span class="nb">fail</span> <span class="s2">"Please add labels to this PR"</span> <span class="k">if</span> <span class="n">bitbucket_server</span><span class="o">.</span><span class="n">pr_labels</span><span class="o">.</span><span class="n">empty?</span>
</pre></div>
<h4>Ensure there is a summary for a PR</h4>
<div class="highlight"><pre><span class="nb">fail</span> <span class="s2">"Please provide a summary in the Pull Request description"</span> <span class="k">if</span> <span class="n">bitbucket_server</span><span class="o">.</span><span class="n">pr_body</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="mi">5</span>
</pre></div>
<h4>Only accept PRs to the develop branch</h4>
<div class="highlight"><pre><span class="nb">fail</span> <span class="s2">"Please re-submit this PR to develop, we may have already fixed your issue."</span> <span class="k">if</span> <span class="n">bitbucket_server</span><span class="o">.</span><span class="n">branch_for_base</span> <span class="o">!=</span> <span class="s2">"develop"</span>
</pre></div>
<h4>Highlight when a celebrity makes a pull request</h4>
<div class="highlight"><pre><span class="n">message</span> <span class="s2">"Welcome, Danger."</span> <span class="k">if</span> <span class="n">bitbucket_server</span><span class="o">.</span><span class="n">pr_author</span> <span class="o">==</span> <span class="s2">"dangermcshane"</span>
</pre></div>
<h4>Ensure that all PRs have an assignee</h4>
<div class="highlight"><pre><span class="nb">warn</span> <span class="s2">"This PR does not have any assignees yet."</span> <span class="k">unless</span> <span class="n">bitbucket_server</span><span class="o">.</span><span class="n">pr_json</span><span class="o">[</span><span class="s2">"reviewers"</span><span class="o">].</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>
<h4>Send a message with links to a collection of specific files</h4>
<div class="highlight"><pre><span class="k">if</span> <span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">include?</span> <span class="s2">"config/*.js"</span>
  <span class="n">config_files</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span> <span class="n">path</span><span class="o">.</span><span class="n">include?</span> <span class="s2">"config/"</span> <span class="p">}</span>
  <span class="n">message</span> <span class="s2">"This PR changes </span><span class="si">#{</span> <span class="n">bitbucket_server</span><span class="o">.</span><span class="n">html_link</span><span class="p">(</span><span class="n">config_files</span><span class="p">)</span> <span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</pre></div>
<h4>Highlight with a clickable link if a Package.json is changed</h4>
<div class="highlight"><pre><span class="nb">warn</span> <span class="s2">"</span><span class="si">#{</span><span class="n">bitbucket_server</span><span class="o">.</span><span class="n">html_link</span><span class="p">(</span><span class="s2">"Package.json"</span><span class="p">)</span><span class="si">}</span><span class="s2"> was edited."</span> <span class="k">if</span> <span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">include?</span> <span class="s2">"Package.json"</span>
</pre></div></article><div class="clearfix"></div>

</section><h2><span>danger</span></h2>
<section><article class="scope_code"><p>A way to interact with Danger herself. Offering APIs to import plugins,
and Dangerfiles from muliple sources.</p>
<h3>Reference</h3>
<h4>Methods</h4>
<div class="fake_code">
<p>Download a local or remote plugin and make it usable inside the Dangerfile.</p>
</div>
<code>import_plugin (path_or_url: String)</code><div class="fake_code">
<p>Import a Dangerfile.</p>
</div>
<code>import_dangerfile (opts: Hash)</code><div class="fake_code">
<p>Returns the name of the current SCM Provider being used.</p>
</div>
<code>scm_provider <span class="subtle return">Symbol</span></code></article><article class="scope_code"><h3>Examples</h3>
<h4>Import a plugin available over HTTP</h4>
<div class="highlight"><pre><span class="n">device_grid</span> <span class="o">=</span> <span class="s2">"https://raw.githubusercontent.com/fastlane/fastlane/master/danger-device_grid/lib/device_grid/plugin.rb"</span>
<span class="n">danger</span><span class="o">.</span><span class="n">import_plugin</span><span class="p">(</span><span class="n">device_grid</span><span class="p">)</span>
</pre></div>
<h4>Import from a local file reference</h4>
<div class="highlight"><pre><span class="n">danger</span><span class="o">.</span><span class="n">import_plugin</span><span class="p">(</span><span class="s2">"danger/plugins/watch_plugin.rb"</span><span class="p">)</span>
</pre></div>
<h4>Import all files inside a folder</h4>
<div class="highlight"><pre><span class="n">danger</span><span class="o">.</span><span class="n">import_plugin</span><span class="p">(</span><span class="s2">"danger/plugins/*.rb"</span><span class="p">)</span>
</pre></div>
<h4>Run a Dangerfile from inside a sub-folder</h4>
<div class="highlight"><pre><span class="n">danger</span><span class="o">.</span><span class="n">import_dangerfile</span><span class="p">(</span><span class="ss">file</span><span class="p">:</span> <span class="s2">"danger/Dangerfile.private"</span><span class="p">)</span>
</pre></div>
<h4>Run a Dangerfile from inside a gem</h4>
<div class="highlight"><pre><span class="n">danger</span><span class="o">.</span><span class="n">import_dangerfile</span><span class="p">(</span><span class="ss">gem</span><span class="p">:</span> <span class="s2">"ruby-grape-danger"</span><span class="p">)</span>
</pre></div>
<h4>Run a Dangerfile from inside a repo</h4>
<div class="highlight"><pre><span class="n">danger</span><span class="o">.</span><span class="n">import_dangerfile</span><span class="p">(</span><span class="ss">gitlab</span><span class="p">:</span> <span class="s2">"ruby-grape/danger"</span><span class="p">)</span>
</pre></div></article><div class="clearfix"></div></section><h2><span>git</span></h2>
<section>

<article class="scope_code"><p>Handles interacting with git inside a Dangerfile. Providing access to files that have changed, and useful statistics. Also provides
access to the commits in the form of <a href="https://github.com/schacon/ruby-git/blob/master/lib/git/log.rb" target="_blank">Git::Log</a> objects.</p>
<h3>Reference</h3>
<h4>Methods</h4>
<div class="fake_code">
<p>Paths for files that were added during the diff</p>
</div>
<code>added_files <span class="subtle return">FileList<string></string></span></code><div class="fake_code">
<p>Paths for files that were removed during the diff</p>
</div>
<code>deleted_files <span class="subtle return">FileList<string></string></span></code><div class="fake_code">
<p>Paths for files that changed during the diff</p>
</div>
<code>modified_files <span class="subtle return">FileList<string></string></span></code><div class="fake_code">
<p>The overall lines of code added/removed in the diff</p>
</div>
<code>lines_of_code <span class="subtle return">Fixnum</span></code><div class="fake_code">
<p>The overall lines of code removed in the diff</p>
</div>
<code>deletions <span class="subtle return">Fixnum</span></code><div class="fake_code">
<p>The overall lines of code added in the diff</p>
</div>
<code>insertions <span class="subtle return">Fixnum</span></code><div class="fake_code">
<p>The log of commits inside the diff</p>
</div>
<code>commits <span class="subtle return">Git::Log</span></code><div class="fake_code">
<p>Details for a specific file in this diff</p>
</div>
<code>diff_for_file <span class="subtle return">Git::Diff::DiffFile</span></code><div class="fake_code">
<p>Statistics for a specific file in this diff</p>
</div>
<code>info_for_file <span class="subtle return">Hash</span></code></article><article class="scope_code"><h3>Examples</h3>
<h4>Do something to all new and edited markdown files</h4>
<div class="highlight"><pre><span class="n">markdowns</span> <span class="o">=</span> <span class="p">(</span><span class="n">git</span><span class="o">.</span><span class="n">added_files</span> <span class="o">+</span> <span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="p">)</span>
<span class="n">do_something</span> <span class="n">markdowns</span><span class="o">.</span><span class="n">select</span><span class="p">{</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span> <span class="n">file</span><span class="o">.</span><span class="n">end_with?</span> <span class="s2">"md"</span> <span class="p">}</span>
</pre></div>
<h4>Don't allow a file to be deleted</h4>
<div class="highlight"><pre><span class="n">deleted</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">deleted_files</span><span class="o">.</span><span class="n">include?</span> <span class="s2">"my/favourite.file"</span>
<span class="nb">fail</span> <span class="s2">"Don't delete my precious"</span> <span class="k">if</span> <span class="n">deleted</span>
</pre></div>
<h4>Fail really big diffs</h4>
<div class="highlight"><pre><span class="nb">fail</span> <span class="s2">"We cannot handle the scale of this PR"</span> <span class="k">if</span> <span class="n">git</span><span class="o">.</span><span class="n">lines_of_code</span> <span class="o">&gt;</span> <span class="mi">50_000</span>
</pre></div>
<h4>Warn when there are merge commits in the diff</h4>
<div class="highlight"><pre><span class="k">if</span> <span class="n">commits</span><span class="o">.</span><span class="n">any?</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="o">.</span><span class="n">message</span> <span class="o">=~</span> <span class="sr">/^Merge branch 'master'/</span> <span class="p">}</span>
  <span class="nb">warn</span> <span class="s1">'Please rebase to get rid of the merge commits in this PR'</span>
<span class="k">end</span>
</pre></div>
<h4>Warn when somebody tries to add nokogiri to the project</h4>
<div class="highlight"><pre><span class="n">diff</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">diff_for_file</span><span class="o">[</span><span class="s2">"Gemfile.lock"</span><span class="o">]</span>
<span class="k">if</span> <span class="n">diff</span> <span class="o">&amp;&amp;</span> <span class="n">diff</span><span class="o">.</span><span class="n">patch</span> <span class="o">=~</span> <span class="s2">"nokogiri"</span>
  <span class="nb">warn</span> <span class="s1">'Please do not add nokogiri to the project. Thank you.'</span>
<span class="k">end</span>
</pre></div></article><div class="clearfix"></div>

</section><h2><span>github</span></h2>
<section>

<article class="scope_code"><p>Handles interacting with GitHub inside a Dangerfile. Provides a few functions which wrap <code>pr_json</code> and also
through a few standard functions to simplify your code.</p>
<h3>Reference</h3>
<h4>Methods</h4>
<div class="fake_code">
<p>The title of the Pull Request.</p>
</div>
<code>pr_title <span class="subtle return">String</span></code><div class="fake_code">
<p>The body text of the Pull Request.</p>
</div>
<code>pr_body <span class="subtle return">String</span></code><div class="fake_code">
<p>The username of the author of the Pull Request.</p>
</div>
<code>pr_author <span class="subtle return">String</span></code><div class="fake_code">
<p>The labels assigned to the Pull Request.</p>
</div>
<code>pr_labels <span class="subtle return">String</span></code><div class="fake_code">
<p>The branch to which the PR is going to be merged into.</p>
</div>
<code>branch_for_base <span class="subtle return">String</span></code><div class="fake_code">
<p>The branch to which the PR is going to be merged from.</p>
</div>
<code>branch_for_head <span class="subtle return">String</span></code><div class="fake_code">
<p>The base commit to which the PR is going to be merged as a parent.</p>
</div>
<code>base_commit <span class="subtle return">String</span></code><div class="fake_code">
<p>The head commit to which the PR is requesting to be merged from.</p>
</div>
<code>head_commit <span class="subtle return">String</span></code><div class="fake_code">
<p>The hash that represents the PR's JSON. For an example of what this looks like
see the <a href="https://raw.githubusercontent.com/danger/danger/master/spec/fixtures/github_api/pr_response.json" target="_blank">Danger Fixture'd one</a>.</p>
</div>
<code>pr_json <span class="subtle return">Hash</span></code><div class="fake_code">
<p>Provides access to the GitHub API client used inside Danger. Making
it easy to use the GitHub API inside a Dangerfile.</p>
</div>
<code>api <span class="subtle return">Octokit::Client</span></code><div class="fake_code">
<p>The unified diff produced by Github for this PR
see <a href="https://en.wikipedia.org/wiki/Diff_utility#Unified_format" target="_blank">Unified diff</a></p>
</div>
<code>pr_diff <span class="subtle return">String</span></code><div class="fake_code">
<p>Returns a list of HTML anchors for a file, or files in the head repository. An example would be:
<code>&lt;a href='https://github.com/artsy/eigen/blob/561827e46167077b5e53515b4b7349b8ae04610b/file.txt'&gt;file.txt&lt;/a&gt;</code>. It returns a string of multiple anchors if passed an array.</p>
</div>
<code>html_link (paths: String or Array<string>, full_path=true: Bool)<span class="subtle return">String</span></string></code></article><article class="scope_code"><h3>Examples</h3>
<h4>Warn when a PR is classed as work in progress</h4>
<div class="highlight"><pre><span class="nb">warn</span> <span class="s2">"PR is classed as Work in Progress"</span> <span class="k">if</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_title</span><span class="o">.</span><span class="n">include?</span> <span class="s2">"[WIP]"</span>
</pre></div>
<h4>Declare a PR to be simple to avoid specific Danger rules</h4>
<div class="highlight"><pre><span class="n">declared_trivial</span> <span class="o">=</span> <span class="p">(</span><span class="n">github</span><span class="o">.</span><span class="n">pr_title</span> <span class="o">+</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_body</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">"#trivial"</span><span class="p">)</span>
</pre></div>
<h4>Ensure that labels have been used on the PR</h4>
<div class="highlight"><pre><span class="nb">fail</span> <span class="s2">"Please add labels to this PR"</span> <span class="k">if</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_labels</span><span class="o">.</span><span class="n">empty?</span>
</pre></div>
<h4>Check if a user is in a specific GitHub org, and message them if so</h4>
<div class="highlight"><pre><span class="k">unless</span> <span class="n">github</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">organization_member?</span><span class="p">(</span><span class="s1">'danger'</span><span class="p">,</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_author</span><span class="p">)</span>
  <span class="n">message</span> <span class="s2">"@</span><span class="si">#{</span><span class="n">github</span><span class="o">.</span><span class="n">pr_author</span><span class="si">}</span><span class="s2"> is not a contributor yet, would you like to join the Danger org?"</span>
<span class="k">end</span>
</pre></div>
<h4>Ensure there is a summary for a PR</h4>
<div class="highlight"><pre><span class="nb">fail</span> <span class="s2">"Please provide a summary in the Pull Request description"</span> <span class="k">if</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_body</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="mi">5</span>
</pre></div>
<h4>Only accept PRs to the develop branch</h4>
<div class="highlight"><pre><span class="nb">fail</span> <span class="s2">"Please re-submit this PR to develop, we may have already fixed your issue."</span> <span class="k">if</span> <span class="n">github</span><span class="o">.</span><span class="n">branch_for_base</span> <span class="o">!=</span> <span class="s2">"develop"</span>
</pre></div>
<h4>Note when PRs don't reference a milestone, which goes away when it does</h4>
<div class="highlight"><pre><span class="n">has_milestone</span> <span class="o">=</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_json</span><span class="o">[</span><span class="s2">"milestone"</span><span class="o">]</span> <span class="o">!=</span> <span class="kp">nil</span>
<span class="nb">warn</span><span class="p">(</span><span class="s2">"This PR does not refer to an existing milestone"</span><span class="p">,</span> <span class="ss">sticky</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span> <span class="k">unless</span> <span class="n">has_milestone</span>
</pre></div>
<h4>Note when a PR cannot be manually merged, which goes away when you can</h4>
<div class="highlight"><pre><span class="n">can_merge</span> <span class="o">=</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_json</span><span class="o">[</span><span class="s2">"mergeable"</span><span class="o">]</span>
<span class="nb">warn</span><span class="p">(</span><span class="s2">"This PR cannot be merged yet."</span><span class="p">,</span> <span class="ss">sticky</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span> <span class="k">unless</span> <span class="n">can_merge</span>
</pre></div>
<h4>Highlight when a celebrity makes a pull request</h4>
<div class="highlight"><pre><span class="n">message</span> <span class="s2">"Welcome, Danger."</span> <span class="k">if</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_author</span> <span class="o">==</span> <span class="s2">"dangermcshane"</span>
</pre></div>
<h4>Ensure that all PRs have an assignee</h4>
<div class="highlight"><pre><span class="nb">warn</span> <span class="s2">"This PR does not have any assignees yet."</span> <span class="k">unless</span> <span class="n">github</span><span class="o">.</span><span class="n">pr_json</span><span class="o">[</span><span class="s2">"assignee"</span><span class="o">]</span>
</pre></div>
<h4>Send a message with links to a collection of specific files</h4>
<div class="highlight"><pre><span class="k">if</span> <span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">include?</span> <span class="s2">"config/*.js"</span>
  <span class="n">config_files</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span> <span class="n">path</span><span class="o">.</span><span class="n">include?</span> <span class="s2">"config/"</span> <span class="p">}</span>
  <span class="n">message</span> <span class="s2">"This PR changes </span><span class="si">#{</span> <span class="n">github</span><span class="o">.</span><span class="n">html_link</span><span class="p">(</span><span class="n">config_files</span><span class="p">)</span> <span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</pre></div>
<h4>Highlight with a clickable link if a Package.json is changed</h4>
<div class="highlight"><pre><span class="nb">warn</span> <span class="s2">"</span><span class="si">#{</span><span class="n">github</span><span class="o">.</span><span class="n">html_link</span><span class="p">(</span><span class="s2">"Package.json"</span><span class="p">)</span><span class="si">}</span><span class="s2"> was edited."</span> <span class="k">if</span> <span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">include?</span> <span class="s2">"Package.json"</span>
</pre></div>
<h4>Note an issue with a particular line on a file using the #L[num] syntax, e.g. `#L23`</h4>
<div class="highlight"><pre><span class="n">linter_json</span> <span class="o">=</span> <span class="sb">`my_linter lint "file"`</span>
<span class="n">results</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span> <span class="n">linter_json</span>
<span class="k">unless</span> <span class="n">results</span><span class="o">.</span><span class="n">empty?</span>
  <span class="n">file</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">warning</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">first</span>
  <span class="nb">warn</span> <span class="s2">"</span><span class="si">#{</span><span class="n">github</span><span class="o">.</span><span class="n">html_link</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">file</span><span class="si">}</span><span class="s2">#L</span><span class="si">#{</span><span class="n">line</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span><span class="si">}</span><span class="s2"> has linter issue: </span><span class="si">#{</span><span class="n">warning</span><span class="si">}</span><span class="s2">."</span>
<span class="k">end</span>
</pre></div></article><div class="clearfix"></div>

</section><h2><span>gitlab</span></h2>
<section>

<article class="scope_code"><p>Handles interacting with GitLab inside a Dangerfile. Provides a few functions which wrap <code>mr_json</code> and also
through a few standard functions to simplify your code.</p>
<h3>Reference</h3>
<h4>Methods</h4>
<div class="fake_code">
<p>The title of the Merge Request</p>
</div>
<code>mr_title <span class="subtle return">String</span></code><div class="fake_code">
<p>The body text of the Merge Request</p>
</div>
<code>mr_body <span class="subtle return">String</span></code><div class="fake_code">
<p>The username of the author of the Merge Request</p>
</div>
<code>mr_author <span class="subtle return">String</span></code><div class="fake_code">
<p>The labels assigned to the Merge Request</p>
</div>
<code>mr_labels <span class="subtle return">String</span></code><div class="fake_code">
<p>The unified diff produced by GitLab for this MR
see <a href="https://en.wikipedia.org/wiki/Diff_utility#Unified_format" target="_blank">Unified diff</a></p>
</div>
<code>mr_diff <span class="subtle return">String</span></code><div class="fake_code">
<p>The branch to which the MR is going to be merged into</p>
</div>
<code>branch_for_merge <span class="subtle return">String</span></code><div class="fake_code">
<p>The branch to which the MR is going to be merged into.</p>
</div>
<code>branch_for_base <span class="subtle return">String</span></code><div class="fake_code">
<p>The branch to which the MR is going to be merged from.</p>
</div>
<code>branch_for_head <span class="subtle return">String</span></code><div class="fake_code">
<p>The base commit to which the MR is going to be merged as a parent</p>
</div>
<code>base_commit <span class="subtle return">String</span></code><div class="fake_code">
<p>The head commit to which the MR is requesting to be merged from</p>
</div>
<code>head_commit <span class="subtle return">String</span></code><div class="fake_code">
<p>The hash that represents the MR's JSON. See documentation for the
structure <a href="http://docs.gitlab.com/ce/api/merge_requests.html#get-single-mr" target="_blank">here</a></p>
</div>
<code>mr_json <span class="subtle return">Hash</span></code><div class="fake_code">
<p>Provides access to the GitLab API client used inside Danger. Making
it easy to use the GitLab API inside a Dangerfile. See the gitlab
gem's <a href="http://www.rubydoc.info/gems/gitlab/Gitlab/Client" target="_blank">documentation</a>
for accessible methods.</p>
</div>
<code>api <span class="subtle return">GitLab::Client</span></code><div class="fake_code">
<p>Returns a list of HTML anchors for a file, or files in the head repository. An example would be:
<code>&lt;a href='https://gitlab.com/artsy/eigen/blob/561827e46167077b5e53515b4b7349b8ae04610b/file.txt'&gt;file.txt&lt;/a&gt;</code>. It returns a string of multiple anchors if passed an array.</p>
</div>
<code>html_link (paths: String or Array<string>, full_path=true: Bool)<span class="subtle return">String</span></string></code></article><article class="scope_code"><h3>Examples</h3>
<h4>Warn when an MR is classed as work in progress.</h4>
<div class="highlight"><pre><span class="nb">warn</span> <span class="s2">"MR is classed as Work in Progress"</span> <span class="k">if</span> <span class="n">gitlab</span><span class="o">.</span><span class="n">mr_title</span><span class="o">.</span><span class="n">include?</span> <span class="s2">"[WIP]"</span>
</pre></div>
<h4>Declare a MR to be simple to avoid specific Danger rules.</h4>
<div class="highlight"><pre><span class="n">declared_trivial</span> <span class="o">=</span> <span class="p">(</span><span class="n">gitlab</span><span class="o">.</span><span class="n">mr_title</span> <span class="o">+</span> <span class="n">gitlab</span><span class="o">.</span><span class="n">mr_body</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s2">"#trivial"</span><span class="p">)</span>
</pre></div>
<h4>Ensure that labels have been applied to the MR.</h4>
<div class="highlight"><pre><span class="nb">fail</span> <span class="s2">"Please add labels to this MR"</span> <span class="k">if</span> <span class="n">gitlab</span><span class="o">.</span><span class="n">mr_labels</span><span class="o">.</span><span class="n">empty?</span>
</pre></div>
<h4>Ensure that all MRs have an assignee.</h4>
<div class="highlight"><pre><span class="nb">warn</span> <span class="s2">"This MR does not have any assignees yet."</span> <span class="k">unless</span> <span class="n">gitlab</span><span class="o">.</span><span class="n">mr_json</span><span class="o">[</span><span class="s2">"assignee"</span><span class="o">]</span>
</pre></div>
<h4>Ensure there is a summary for a MR.</h4>
<div class="highlight"><pre><span class="nb">fail</span> <span class="s2">"Please provide a summary in the Merge Request description"</span> <span class="k">if</span> <span class="n">gitlab</span><span class="o">.</span><span class="n">mr_body</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="mi">5</span>
</pre></div>
<h4>Only accept MRs to the develop branch.</h4>
<div class="highlight"><pre><span class="nb">fail</span> <span class="s2">"Please re-submit this MR to develop, we may have already fixed your issue."</span> <span class="k">if</span> <span class="n">gitlab</span><span class="o">.</span><span class="n">branch_for_merge</span> <span class="o">!=</span> <span class="s2">"develop"</span>
</pre></div>
<h4>Note when MRs don't reference a milestone, which goes away when it does.</h4>
<div class="highlight"><pre><span class="n">has_milestone</span> <span class="o">=</span> <span class="n">gitlab</span><span class="o">.</span><span class="n">mr_json</span><span class="o">[</span><span class="s2">"milestone"</span><span class="o">]</span> <span class="o">!=</span> <span class="kp">nil</span>
<span class="nb">warn</span><span class="p">(</span><span class="s2">"This MR does not refer to an existing milestone"</span><span class="p">,</span> <span class="ss">sticky</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span> <span class="k">unless</span> <span class="n">has_milestone</span>
</pre></div>
<h4>Note when a MR cannot be manually merged, which goes away when you can.</h4>
<div class="highlight"><pre><span class="n">can_merge</span> <span class="o">=</span> <span class="n">gitlab</span><span class="o">.</span><span class="n">mr_json</span><span class="o">[</span><span class="s2">"mergeable"</span><span class="o">]</span>
<span class="nb">warn</span><span class="p">(</span><span class="s2">"This MR cannot be merged yet."</span><span class="p">,</span> <span class="ss">sticky</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span> <span class="k">unless</span> <span class="n">can_merge</span>
</pre></div>
<h4>Highlight when a celebrity makes a merge request.</h4>
<div class="highlight"><pre><span class="n">message</span> <span class="s2">"Welcome, Danger."</span> <span class="k">if</span> <span class="n">gitlab</span><span class="o">.</span><span class="n">mr_author</span> <span class="o">==</span> <span class="s2">"dangermcshane"</span>
</pre></div>
<h4>Send a message with links to a collection of specific files.</h4>
<div class="highlight"><pre><span class="k">if</span> <span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">include?</span> <span class="s2">"config/*.js"</span>
  <span class="n">config_files</span> <span class="o">=</span> <span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span> <span class="n">path</span><span class="o">.</span><span class="n">include?</span> <span class="s2">"config/"</span> <span class="p">}</span>
  <span class="n">message</span> <span class="s2">"This MR changes </span><span class="si">#{</span> <span class="n">gitlab</span><span class="o">.</span><span class="n">html_link</span><span class="p">(</span><span class="n">config_files</span><span class="p">)</span> <span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</pre></div>
<h4>Highlight with a clickable link if a Package.json is changed.</h4>
<div class="highlight"><pre><span class="nb">warn</span> <span class="s2">"</span><span class="si">#{</span><span class="n">gitlab</span><span class="o">.</span><span class="n">html_link</span><span class="p">(</span><span class="s2">"Package.json"</span><span class="p">)</span><span class="si">}</span><span class="s2"> was edited."</span> <span class="k">if</span> <span class="n">git</span><span class="o">.</span><span class="n">modified_files</span><span class="o">.</span><span class="n">include?</span> <span class="s2">"Package.json"</span>
</pre></div></article><div class="clearfix"></div>

</section><h2><span>messaging</span></h2>
<section><article class="scope_code"><p>Provides the feedback mechanism for Danger. Danger can keep track of
messages, warnings, failure and post arbitrary markdown into a comment.</p>

<p>The message within which Danger communicates back is amended on each run in a session.</p>

<p>Each of <code>message</code>, <code>warn</code> and <code>fail</code> have a <code>sticky</code> flag, <code>true</code> by default, which
means that the message will be crossed out instead of being removed. If it's not use on
subsequent runs.</p>

<p>By default, using <code>fail</code> would fail the corresponding build. Either via an API call, or
via the return value for the danger command.</p>

<p>It is possible to have Danger ignore specific warnings or errors by writing <code>Danger: Ignore "[warning/error text]</code>.</p>

<p>Sidenote: Messaging is the only plugin which adds functions to the root of the Dangerfile.</p>
<h3>Reference</h3>
<h4>Methods</h4>
<div class="fake_code">
<p>Print markdown to below the table</p>
</div>
<code>markdown (message: String, file=nil: String, line=nil: String)</code><div class="fake_code">
<p>Print out a generate message on the PR</p>
</div>
<code>message (message: String, sticky=true: Boolean, file=nil: String, line=nil: String)</code><div class="fake_code">
<p>Specifies a problem, but not critical</p>
</div>
<code>warn (message: String, sticky=true: Boolean, file=nil: String, line=nil: String)</code><div class="fake_code">
<p>Declares a CI blocking error</p>
</div>
<code>fail (message: String, sticky=true: Boolean, file=nil: String, line=nil: String)</code><div class="fake_code">
<p>A list of all messages passed to Danger, including
the markdowns.</p>
</div>
<code>status_report <span class="subtle return">Hash</span></code><div class="fake_code">
<p>A list of all violations passed to Danger, we don't
anticipate users of Danger needing to use this.</p>
</div>
<code>violation_report <span class="subtle return">Hash</span></code></article><article class="scope_code"><h3>Examples</h3>
<h4>Failing a build</h4>
<div class="highlight"><pre><span class="nb">fail</span> <span class="s2">"This build didn't pass tests"</span>
</pre></div>
<h4>Failing a build, but not keeping its value around on subsequent runs</h4>
<div class="highlight"><pre><span class="nb">fail</span><span class="p">(</span><span class="s2">"This build didn't pass tests"</span><span class="p">,</span> <span class="ss">sticky</span><span class="p">:</span> <span class="kp">false</span><span class="p">)</span>
</pre></div>
<h4>Passing a warning</h4>
<div class="highlight"><pre><span class="nb">warn</span> <span class="s2">"This build didn't pass linting"</span>
</pre></div>
<h4>Displaying a markdown table</h4>
<div class="highlight"><pre><span class="n">message</span> <span class="o">=</span> <span class="s2">"### Proselint found issues</span><span class="se">\n\n</span><span class="s2">"</span>
<span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="s2">"Line | Message | Severity |</span><span class="se">\n</span><span class="s2">"</span>
<span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="s2">"| --- | ----- | ----- |</span><span class="se">\n</span><span class="s2">"</span>
<span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="s2">"20 | No documentation | Error </span><span class="se">\n</span><span class="s2">"</span>
<span class="n">markdown</span> <span class="n">message</span>
</pre></div>
<h4>Adding an inline warning to a file</h4>
<div class="highlight"><pre><span class="nb">warn</span><span class="p">(</span><span class="s2">"You shouldn't use puts in your Dangerfile"</span><span class="p">,</span> <span class="ss">file</span><span class="p">:</span> <span class="s2">"Dangerfile"</span><span class="p">,</span> <span class="ss">line</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span>
</pre></div></article><div class="clearfix"></div></section>

<footer><article><h3>GitHub</h3>
<ul><li><a href="https://github.com/danger/danger" target="_blank">danger/danger</a></li></ul>
<h3>Twitter</h3>
<ul>
<li><a href="https://twitter.com/DangerSystems" target="_blank">@DangerSystems</a></li>
<li><a href="https://twitter.com/orta" target="_blank">@orta</a></li>
<li><a href="https://twitter.com/krausefx" target="_blank">@krausefx</a></li>
</ul></article><article><h3>Guides</h3>
<ul>
<li><a href="/guides/getting_started.html">Getting Set Up</a></li>
<li><a href="/guides/dangerfile.html">The Dangerfile</a></li>
<li><a href="/guides/what_does_danger_do.html">What does Danger do?</a></li>
<li><a href="/guides/creating_your_first_plugin.html">Creating your first Plugin</a></li>
<li><a href="/guides/a_quick_ruby_overview.html">A Quick Ruby Overview</a></li>
<li><a href="/guides/faq.html">Frequently Asked Questions</a></li>
<li><a href="/guides/troubleshooting.html">Troubleshooting</a></li>
</ul></article><article><h3>Misc</h3>
<ul>
<li><a href="/reference.html">DSL Reference</a></li>
<li><a href="https://github.com/danger/danger/blob/master/CHANGELOG.md" target="_blank">CHANGELOG.md</a></li>
<li><a href="https://github.com/danger/design" target="_blank">Media Kit</a></li>
<li><a href="https://github.com/danger/danger#license-contributors-guidelines-and-code-of-conduct" target="_blank">COC / Moya CC</a></li>
<li><a href="https://github.com/danger/danger#im-here-to-help-out" target="_blank">Help Out Building Danger</a></li>
</ul></article><article><a href="/images/dm-opinions-316f5af1.png"><img height="244" src="/images/dm-opinions-316f5af1.png" width="203"></a></article></footer>
</body>
</html><html><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-81285417-1', 'auto');
ga('send', 'pageview');</script></html>
